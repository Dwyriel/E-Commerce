(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"2MiI":function(t,i,e){"use strict";e.d(i,"a",function(){return d});var s=e("OGMK"),r=e("fXoL"),n=e("ofXK"),o=e("TEn/");function c(t,i){if(1&t&&(r.Rb(0,"ion-header",3),r.Rb(1,"ion-toolbar"),r.Rb(2,"ion-buttons",4),r.Nb(3,"ion-menu-button"),r.Qb(),r.Rb(4,"ion-title"),r.rc(5),r.Qb(),r.Qb(),r.Qb()),2&t){const t=r.bc();r.hc("translucent",!0),r.Bb(5),r.sc(t.title)}}function a(t,i){if(1&t&&(r.Rb(0,"ion-header",5),r.Rb(1,"ion-toolbar"),r.Rb(2,"ion-title",6),r.rc(3),r.Qb(),r.Qb(),r.Qb()),2&t){const t=r.bc();r.Bb(3),r.sc(t.title)}}function u(t,i){1&t&&r.Nb(0,"div",7)}let d=(()=>{class t{constructor(){this.title="",this.isMobile=!0}ngOnInit(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe(),this.subscription=s.a.GetAppInfo().subscribe(t=>{this.isMobile=t.appWidth<=s.a.maxMobileWidth})}ngOnDestroy(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=r.Gb({type:t,selectors:[["app-header"]],inputs:{title:"title",segment:"segment"},decls:3,vars:3,consts:[[3,"translucent",4,"ngIf"],["collapse","condense",4,"ngIf"],["style","width: 100%; height: 65px;",4,"ngIf"],[3,"translucent"],["slot","start"],["collapse","condense"],["size","large"],[2,"width","100%","height","65px"]],template:function(t,i){1&t&&(r.qc(0,c,6,2,"ion-header",0),r.qc(1,a,4,1,"ion-header",1),r.qc(2,u,1,0,"div",2)),2&t&&(r.hc("ngIf",i.isMobile&&"0"==i.segment),r.Bb(1),r.hc("ngIf",i.isMobile&&"1"==i.segment),r.Bb(1),r.hc("ngIf",!i.isMobile&&"0"==i.segment))},directives:[n.k,o.o,o.T,o.f,o.B,o.S],styles:[""]}),t})()},dagM:function(t,i,e){"use strict";e.d(i,"a",function(){return a});var s=e("ofXK"),r=e("3Pt+"),n=e("tyNb"),o=e("TEn/"),c=e("fXoL");let a=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({imports:[[o.U,s.b,r.a,n.k]]}),t})()},tZSS:function(t,i,e){"use strict";e.r(i),e.d(i,"CartPageModule",function(){return Q});var s=e("ofXK"),r=e("3Pt+"),n=e("TEn/"),o=e("tyNb"),c=e("mrSG"),a=e("OGMK"),u=e("fcTE"),d=e("fXoL"),l=e("qfBg"),h=e("3LUQ"),b=e("Gdn9"),p=e("c14U"),f=e("xHty"),m=e("2MiI");function g(t,i){1&t&&(d.Rb(0,"div"),d.Rb(1,"p",6),d.rc(2,"Carrinho esta vazio, adicione um item primeiro "),d.Rb(3,"a",7),d.rc(4,"aqui"),d.Qb(),d.Qb(),d.Qb())}function v(t,i){if(1&t&&d.Nb(0,"img",17),2&t){const t=d.bc().$implicit;d.hc("src",t.product.gallery[0],d.oc)("alt",t.product.name)}}function y(t,i){if(1&t){const t=d.Sb();d.Rb(0,"ion-row"),d.Rb(1,"ion-col",9),d.Rb(2,"ion-item",10),d.qc(3,v,1,2,"img",11),d.Rb(4,"ion-label"),d.Rb(5,"h2"),d.rc(6),d.Qb(),d.Rb(7,"h3"),d.rc(8),d.cc(9,"currency"),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Rb(10,"ion-col",12),d.Rb(11,"ion-icon",13),d.Zb("click",function(){d.nc(t);const e=i.$implicit;return d.bc(2).DecreaseAmount(e.product.id)}),d.Qb(),d.Qb(),d.Rb(12,"ion-col",14),d.Rb(13,"h2"),d.rc(14),d.Qb(),d.Qb(),d.Rb(15,"ion-col",15),d.Rb(16,"ion-icon",16),d.Zb("click",function(){d.nc(t);const e=i.$implicit;return d.bc(2).IncreaseAmount(e.product.id,e.product.stock,e.amount)}),d.Qb(),d.Qb(),d.Qb()}if(2&t){const t=i.$implicit;d.Bb(2),d.jc("routerLink","/product/",t.product.id,""),d.Bb(1),d.hc("ngIf",(null==t.product.gallery?null:t.product.gallery.length)>0),d.Bb(3),d.sc(t.product.name),d.Bb(2),d.sc(d.dc(9,5,t.product.price,"BRL")),d.Bb(6),d.sc(t.amount)}}function S(t,i){if(1&t&&(d.Rb(0,"ion-list"),d.Rb(1,"ion-grid"),d.qc(2,y,17,8,"ion-row",8),d.Qb(),d.Qb()),2&t){const t=d.bc();d.Bb(2),d.hc("ngForOf",t.products)}}function I(t,i){if(1&t){const t=d.Sb();d.Rb(0,"ion-button",18),d.Zb("click",function(){return d.nc(t),d.bc().FinishPurchase()}),d.rc(1,"Finalizar Compra"),d.Qb()}}const O=function(t){return{webrowser:t}},A=[{path:"",component:(()=>{class t{constructor(t,i,e,s,r,n){this.userService=t,this.alertService=i,this.router=e,this.prodServ=s,this.cartServ=r,this.purchaseService=n,this.products=[],this.loading=!0,this.subscriptions=[]}ngOnInit(){}ionViewWillEnter(){this.getUserAndCart(),this.GetPlataformInfo()}ionViewWillLeave(){if(this.loading=!0,this.user=null,this.products=[],this.subscription1&&!this.subscription1.closed&&this.subscription1.unsubscribe(),this.subscription2&&!this.subscription2.closed&&this.subscription2.unsubscribe(),this.subscriptions&&this.subscriptions.length>0){for(var t of this.subscriptions)t&&!t.closed&&t.unsubscribe();this.subscriptions=[]}}GetPlataformInfo(){this.subscription2=a.a.GetAppInfo().subscribe(t=>{this.isMobile=t.appWidth<=a.a.maxMobileWidth,this.setDivWidth(.4*t.appWidth>a.a.maxMobileWidth/1.5?"40%":a.a.maxMobileWidth/1.5+"px")})}setDivWidth(t){document.body.style.setProperty("--maxWidth",t)}getUserAndCart(){return Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.subscription1&&!this.subscription1.closed&&this.subscription1.unsubscribe(),this.subscription1=a.a.GetUserInfo().subscribe(t=>Object(c.b)(this,void 0,void 0,function*(){if(!t)return yield this.router.navigate(["/login"]),void(yield this.alertService.dismissLoading(this.loadingAlert));this.user=t,this.user&&this.user.cart&&this.user.cart.length>0?(this.hasProducts=!0,yield this.getProducts()):(this.hasProducts=!1,this.loading&&(yield this.alertService.dismissLoading(this.loadingAlert),this.loading=!1))}),t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Ops","Algo deu errado, tente novamente mais tarde.")}))})}getProducts(){return Object(c.b)(this,void 0,void 0,function*(){var t=[];if(this.subscriptions&&this.subscriptions.length>0){for(var i of this.subscriptions)i&&!i.closed&&i.unsubscribe();this.subscriptions=[]}var e=!0,s=!0,r=0,n=this.user.cart&&this.user.cart.length>0?this.user.cart.length:null;for(var o of this.user.cart)for(s=!0,this.subscriptions.push((yield this.prodServ.Get(o.productID)).subscribe(i=>{var c=i;c.id=o.productID,t.push({product:c,amount:o.amount}),++r>=n&&(e=!1),s=!1}));s;)yield new Promise(t=>setTimeout(t,10));for(;e;)yield new Promise(t=>setTimeout(t,10));this.products=t,this.loading&&(yield this.alertService.dismissLoading(this.loadingAlert),this.loading=!1)})}DecreaseAmount(t){return Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.cartServ.RemoveItem(t,this.user.cart),yield this.SendChanges(t,!1)})}IncreaseAmount(t,i,e){return Object(c.b)(this,void 0,void 0,function*(){e>=i?this.alertService.presentAlert("Ops","O produto n\xe3o possui mais estoque."):(yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.cartServ.AddItem(t,this.user.cart),yield this.SendChanges(t,!0))})}SendChanges(t,i){return Object(c.b)(this,void 0,void 0,function*(){yield this.userService.UpdateCart(this.user.id,this.user.cart).then(t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.ShowToast("Itens Changed")}),e=>Object(c.b)(this,void 0,void 0,function*(){t&&null!=i&&(i?this.cartServ.RemoveItem(t,this.user.cart):this.cartServ.AddItem(t,this.user.cart),yield this.alertService.presentAlert("Oops",`There was a problem ${i?"increasing":"decreasing"} the amount of the item from the cart`))}))})}FinishPurchase(){return Object(c.b)(this,void 0,void 0,function*(){var t;if(yield this.alertService.confirmationAlert("Comprar","Clique em ok para efetuar a compra.").then(i=>t=i),t){for(var i of(yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.products)){var e=!0,s=Object(u.a)(this.user.id,i.product.sellerID,{productID:i.product.id,amount:i.amount});for(yield this.purchaseService.Add(s).then(()=>Object(c.b)(this,void 0,void 0,function*(){yield this.prodServ.UpdateStock(i.product.id,i.product.stock-i.amount)})).catch(t=>{this.alertService.presentAlert("Ocorreu um erro",`Produto ${i.product.name} n\xe3o pode ser comprado, tente novamente mais tarde.`)}).finally(()=>{e=!1});e;)yield new Promise(t=>setTimeout(t,10))}yield this.userService.UpdateCart(this.user.id,[]).then(()=>Object(c.b)(this,void 0,void 0,function*(){this.user.cart=[],this.products=[],yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Wheee","Os itens comprados seram entregue nos proximos 2534 anos"),yield this.router.navigate(["/purchases/purchases"])}),t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Ops","N\xe3o foi possivel remover os itens do carrinho apos a compra, Por favor verifique suas compras antes de comprar novamente.")}))}})}}return t.\u0275fac=function(i){return new(i||t)(d.Mb(l.a),d.Mb(h.a),d.Mb(o.g),d.Mb(b.a),d.Mb(p.a),d.Mb(f.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["app-cart"]],decls:7,vars:7,consts:[["title","Carrinho","segment","0"],[3,"fullscreen"],["title","Carrinho","segment","1"],[3,"ngClass"],[4,"ngIf"],["vertical","bottom","expand","block","size","large","class","ion-margin",3,"click",4,"ngIf"],[1,"ion-text-center"],["routerLink","/products"],[4,"ngFor","ngForOf"],["size","9"],[3,"routerLink"],[3,"src","alt",4,"ngIf"],["size","1",1,"vertical-align-content","ion-justify-content-end"],["name","chevron-back-outline",3,"click"],["size","1",2,"text-align","center"],["size","1",1,"vertical-align-content","ion-justify-content-start"],["name","chevron-forward-outline",3,"click"],[3,"src","alt"],["vertical","bottom","expand","block","size","large",1,"ion-margin",3,"click"]],template:function(t,i){1&t&&(d.Nb(0,"app-header",0),d.Rb(1,"ion-content",1),d.Nb(2,"app-header",2),d.Rb(3,"div",3),d.qc(4,g,5,0,"div",4),d.qc(5,S,3,1,"ion-list",4),d.qc(6,I,2,0,"ion-button",5),d.Qb(),d.Qb()),2&t&&(d.Bb(1),d.hc("fullscreen",!0),d.Bb(2),d.hc("ngClass",d.kc(5,O,!i.isMobile)),d.Bb(1),d.hc("ngIf",!i.hasProducts),d.Bb(1),d.hc("ngIf",i.hasProducts),d.Bb(1),d.hc("ngIf",i.hasProducts))},directives:[m.a,n.m,s.i,s.k,o.j,n.cb,n.y,n.n,s.j,n.H,n.l,n.s,o.h,n.x,n.p,n.e],pipes:[s.c],styles:[".webrowser[_ngcontent-%COMP%]{text-align:center;width:var(--maxWidth);margin:0 auto;padding-top:1rem}img[_ngcontent-%COMP%]{border-radius:10%;height:40px;width:40px;margin:0 7px 0 0}.vertical-align-content[_ngcontent-%COMP%]{display:flex!important;align-content:center!important;align-items:center!important}"]}),t})()}];let R=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({imports:[[o.k.forChild(A)],o.k]}),t})();var w=e("dagM");let Q=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({imports:[[s.b,r.a,n.U,R,w.a]]}),t})()}}]);