(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"2MiI":function(t,i,e){"use strict";e.d(i,"a",function(){return u});var s=e("OGMK"),r=e("fXoL"),n=e("ofXK"),o=e("TEn/");function c(t,i){if(1&t&&(r.Rb(0,"ion-header",3),r.Rb(1,"ion-toolbar"),r.Rb(2,"ion-buttons",4),r.Nb(3,"ion-menu-button"),r.Qb(),r.Rb(4,"ion-title"),r.rc(5),r.Qb(),r.Qb(),r.Qb()),2&t){const t=r.bc();r.hc("translucent",!0),r.Bb(5),r.sc(t.title)}}function a(t,i){if(1&t&&(r.Rb(0,"ion-header",5),r.Rb(1,"ion-toolbar"),r.Rb(2,"ion-title",6),r.rc(3),r.Qb(),r.Qb(),r.Qb()),2&t){const t=r.bc();r.Bb(3),r.sc(t.title)}}function d(t,i){1&t&&r.Nb(0,"div",7)}let u=(()=>{class t{constructor(){this.title="",this.isMobile=!0}ngOnInit(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe(),this.subscription=s.a.GetAppInfo().subscribe(t=>{this.isMobile=t.appWidth<=s.a.maxMobileWidth})}ngOnDestroy(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=r.Gb({type:t,selectors:[["app-header"]],inputs:{title:"title",segment:"segment"},decls:3,vars:3,consts:[[3,"translucent",4,"ngIf"],["collapse","condense",4,"ngIf"],["style","width: 100%; height: 65px;",4,"ngIf"],[3,"translucent"],["slot","start"],["collapse","condense"],["size","large"],[2,"width","100%","height","65px"]],template:function(t,i){1&t&&(r.qc(0,c,6,2,"ion-header",0),r.qc(1,a,4,1,"ion-header",1),r.qc(2,d,1,0,"div",2)),2&t&&(r.hc("ngIf",i.isMobile&&"0"==i.segment),r.Bb(1),r.hc("ngIf",i.isMobile&&"1"==i.segment),r.Bb(1),r.hc("ngIf",!i.isMobile&&"0"==i.segment))},directives:[n.k,o.o,o.T,o.f,o.B,o.S],styles:[""]}),t})()},dagM:function(t,i,e){"use strict";e.d(i,"a",function(){return a});var s=e("ofXK"),r=e("3Pt+"),n=e("tyNb"),o=e("TEn/"),c=e("fXoL");let a=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({imports:[[o.U,s.b,r.a,n.k]]}),t})()},tZSS:function(t,i,e){"use strict";e.r(i),e.d(i,"CartPageModule",function(){return k});var s=e("ofXK"),r=e("3Pt+"),n=e("TEn/"),o=e("tyNb"),c=e("mrSG"),a=e("OGMK"),d=e("E95c"),u=e("fcTE"),l=e("fXoL"),h=e("qfBg"),b=e("3LUQ"),p=e("Gdn9"),f=e("c14U"),m=e("xHty"),g=e("OC8m"),v=e("2MiI");function y(t,i){1&t&&(l.Rb(0,"div"),l.Rb(1,"p",6),l.rc(2,"Carrinho esta vazio, adicione um item primeiro "),l.Rb(3,"a",7),l.rc(4,"aqui"),l.Qb(),l.Qb(),l.Qb())}function S(t,i){if(1&t&&l.Nb(0,"img",17),2&t){const t=l.bc().$implicit;l.hc("src",t.product.gallery[0],l.oc)("alt",t.product.name)}}function I(t,i){if(1&t){const t=l.Sb();l.Rb(0,"ion-row"),l.Rb(1,"ion-col",9),l.Rb(2,"ion-item",10),l.qc(3,S,1,2,"img",11),l.Rb(4,"ion-label"),l.Rb(5,"h2"),l.rc(6),l.Qb(),l.Rb(7,"h3"),l.rc(8),l.cc(9,"currency"),l.Qb(),l.Qb(),l.Qb(),l.Qb(),l.Rb(10,"ion-col",12),l.Rb(11,"ion-icon",13),l.Zb("click",function(){l.nc(t);const e=i.$implicit;return l.bc(2).DecreaseAmount(e.product.id)}),l.Qb(),l.Qb(),l.Rb(12,"ion-col",14),l.Rb(13,"h2"),l.rc(14),l.Qb(),l.Qb(),l.Rb(15,"ion-col",15),l.Rb(16,"ion-icon",16),l.Zb("click",function(){l.nc(t);const e=i.$implicit;return l.bc(2).IncreaseAmount(e.product.id,e.product.stock,e.amount)}),l.Qb(),l.Qb(),l.Qb()}if(2&t){const t=i.$implicit;l.Bb(2),l.jc("routerLink","/product/",t.product.id,""),l.Bb(1),l.hc("ngIf",(null==t.product.gallery?null:t.product.gallery.length)>0),l.Bb(3),l.sc(t.product.name),l.Bb(2),l.sc(l.dc(9,5,t.product.price,"BRL")),l.Bb(6),l.sc(t.amount)}}function O(t,i){if(1&t&&(l.Rb(0,"ion-list"),l.Rb(1,"ion-grid"),l.qc(2,I,17,8,"ion-row",8),l.Qb(),l.Qb()),2&t){const t=l.bc();l.Bb(2),l.hc("ngForOf",t.products)}}function w(t,i){if(1&t){const t=l.Sb();l.Rb(0,"ion-button",18),l.Zb("click",function(){return l.nc(t),l.bc().FinishPurchase()}),l.rc(1,"Finalizar Compra"),l.Qb()}}const A=function(t){return{webrowser:t}},R=[{path:"",component:(()=>{class t{constructor(t,i,e,s,r,n,o){this.userService=t,this.alertService=i,this.router=e,this.prodServ=s,this.cartServ=r,this.purchaseService=n,this.notificationService=o,this.products=[],this.loading=!0,this.subscriptions=[]}ngOnInit(){}ionViewWillEnter(){this.getUserAndCart(),this.GetPlataformInfo()}ionViewWillLeave(){if(this.loading=!0,this.user=null,this.products=[],this.subscription1&&!this.subscription1.closed&&this.subscription1.unsubscribe(),this.subscription2&&!this.subscription2.closed&&this.subscription2.unsubscribe(),this.subscriptions&&this.subscriptions.length>0){for(var t of this.subscriptions)t&&!t.closed&&t.unsubscribe();this.subscriptions=[]}}GetPlataformInfo(){this.subscription2=a.a.GetAppInfo().subscribe(t=>{this.isMobile=t.appWidth<=a.a.maxMobileWidth,this.setDivWidth(.4*t.appWidth>a.a.maxMobileWidth/1.5?"40%":a.a.maxMobileWidth/1.5+"px")})}setDivWidth(t){document.body.style.setProperty("--maxWidth",t)}getUserAndCart(){return Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.subscription1&&!this.subscription1.closed&&this.subscription1.unsubscribe(),this.subscription1=a.a.GetUserInfo().subscribe(t=>Object(c.b)(this,void 0,void 0,function*(){if(!t)return yield this.router.navigate(["/login"]),void(yield this.alertService.dismissLoading(this.loadingAlert));this.user=t,this.user&&this.user.cart&&this.user.cart.length>0?(this.hasProducts=!0,yield this.getProducts()):(this.hasProducts=!1,this.loading&&(yield this.alertService.dismissLoading(this.loadingAlert),this.loading=!1))}),t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Ops","Algo deu errado, tente novamente mais tarde.")}))})}getProducts(){return Object(c.b)(this,void 0,void 0,function*(){var t=[];if(this.subscriptions&&this.subscriptions.length>0){for(var i of this.subscriptions)i&&!i.closed&&i.unsubscribe();this.subscriptions=[]}var e=!0,s=!0,r=0,n=this.user.cart&&this.user.cart.length>0?this.user.cart.length:null;for(var o of this.user.cart)for(s=!0,this.subscriptions.push((yield this.prodServ.Get(o.productID)).subscribe(i=>{var c=i;c.id=o.productID,t.push({product:c,amount:o.amount}),++r>=n&&(e=!1),s=!1}));s;)yield new Promise(t=>setTimeout(t,10));for(;e;)yield new Promise(t=>setTimeout(t,10));this.products=t.filter((t,i,e)=>i===e.findIndex(i=>i.product.id===t.product.id)),this.loading&&(yield this.alertService.dismissLoading(this.loadingAlert),this.loading=!1)})}DecreaseAmount(t){return Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.cartServ.RemoveItem(t,this.user.cart),yield this.SendChanges(t,!1)})}IncreaseAmount(t,i,e){return Object(c.b)(this,void 0,void 0,function*(){e>=i?this.alertService.presentAlert("Ops","O produto n\xe3o possui mais estoque."):(yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.cartServ.AddItem(t,this.user.cart),yield this.SendChanges(t,!0))})}SendChanges(t,i){return Object(c.b)(this,void 0,void 0,function*(){yield this.userService.UpdateCart(this.user.id,this.user.cart).then(t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.ShowToast("Itens Changed")}),e=>Object(c.b)(this,void 0,void 0,function*(){t&&null!=i&&(i?this.cartServ.RemoveItem(t,this.user.cart):this.cartServ.AddItem(t,this.user.cart),yield this.alertService.presentAlert("Oops",`There was a problem ${i?"increasing":"decreasing"} the amount of the item from the cart`))}))})}FinishPurchase(){return Object(c.b)(this,void 0,void 0,function*(){var t;if(yield this.alertService.confirmationAlert("Comprar","Clique em ok para efetuar a compra.").then(i=>t=i),t){for(var i of(yield this.alertService.presentLoading().then(t=>this.loadingAlert=t),this.products)){var e=!0,s=Object(u.a)(this.user.id,i.product.sellerID,{productID:i.product.id,amount:i.amount});for(yield this.purchaseService.Add(s).then(t=>Object(c.b)(this,void 0,void 0,function*(){yield this.prodServ.UpdateStock(i.product.id,i.product.stock-i.amount),yield this.notificationService.SentNotificationToFirebase(`Voce acabou de vender ${i.amount} ${i.product.name}`,`/purchase/${t.id}`,i.product.sellerID,d.d.newSoldItem)})).catch(t=>{this.alertService.presentAlert("Ocorreu um erro",`Produto ${i.product.name} n\xe3o pode ser comprado, tente novamente mais tarde.`)}).finally(()=>{e=!1});e;)yield new Promise(t=>setTimeout(t,10))}yield this.userService.UpdateCart(this.user.id,[]).then(()=>Object(c.b)(this,void 0,void 0,function*(){this.user.cart=[],this.products=[],yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Wheee","Os itens comprados seram entregue nos proximos 2534 anos"),yield this.router.navigate(["/purchases/purchases"])}),t=>Object(c.b)(this,void 0,void 0,function*(){yield this.alertService.dismissLoading(this.loadingAlert),yield this.alertService.presentAlert("Ops","N\xe3o foi possivel remover os itens do carrinho apos a compra, Por favor verifique suas compras antes de comprar novamente.")}))}})}}return t.\u0275fac=function(i){return new(i||t)(l.Mb(h.a),l.Mb(b.a),l.Mb(o.g),l.Mb(p.a),l.Mb(f.a),l.Mb(m.a),l.Mb(g.a))},t.\u0275cmp=l.Gb({type:t,selectors:[["app-cart"]],decls:7,vars:7,consts:[["title","Carrinho","segment","0"],[3,"fullscreen"],["title","Carrinho","segment","1"],[3,"ngClass"],[4,"ngIf"],["vertical","bottom","expand","block","size","large","class","ion-margin",3,"click",4,"ngIf"],[1,"ion-text-center"],["routerLink","/products"],[4,"ngFor","ngForOf"],["size","9"],[3,"routerLink"],[3,"src","alt",4,"ngIf"],["size","1",1,"vertical-align-content","ion-justify-content-end"],["name","chevron-back-outline",3,"click"],["size","1",2,"text-align","center"],["size","1",1,"vertical-align-content","ion-justify-content-start"],["name","chevron-forward-outline",3,"click"],[3,"src","alt"],["vertical","bottom","expand","block","size","large",1,"ion-margin",3,"click"]],template:function(t,i){1&t&&(l.Nb(0,"app-header",0),l.Rb(1,"ion-content",1),l.Nb(2,"app-header",2),l.Rb(3,"div",3),l.qc(4,y,5,0,"div",4),l.qc(5,O,3,1,"ion-list",4),l.qc(6,w,2,0,"ion-button",5),l.Qb(),l.Qb()),2&t&&(l.Bb(1),l.hc("fullscreen",!0),l.Bb(2),l.hc("ngClass",l.kc(5,A,!i.isMobile)),l.Bb(1),l.hc("ngIf",!i.hasProducts),l.Bb(1),l.hc("ngIf",i.hasProducts),l.Bb(1),l.hc("ngIf",i.hasProducts))},directives:[v.a,n.m,s.i,s.k,o.j,n.cb,n.y,n.n,s.j,n.H,n.l,n.s,o.h,n.x,n.p,n.e],pipes:[s.c],styles:[".webrowser[_ngcontent-%COMP%]{text-align:center;width:var(--maxWidth);margin:0 auto;padding-top:1rem}img[_ngcontent-%COMP%]{border-radius:10%;height:40px;width:40px;margin:0 7px 0 0}.vertical-align-content[_ngcontent-%COMP%]{display:flex!important;align-content:center!important;align-items:center!important}"]}),t})()}];let M=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=l.Kb({type:t}),t.\u0275inj=l.Jb({imports:[[o.k.forChild(R)],o.k]}),t})();var Q=e("dagM");let k=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=l.Kb({type:t}),t.\u0275inj=l.Jb({imports:[[s.b,r.a,n.U,M,Q.a]]}),t})()}}]);